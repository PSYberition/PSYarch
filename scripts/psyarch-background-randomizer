#!/usr/bin/env bash
# ──────────────────────────────────────────────────────────────────────────────────────────────
  [[ "$1" != "run" ]] && { nohup "$0" run > /dev/null 2>&1 & disown; exit; }
# ──────────────────────────────────────────────────────────────────────────────────────────────
  DIR="$HOME/Pictures/Wallpapers"
  BGS="$HOME/.local/state/bgs.txt"
# ──────────────────────────────────────────────────────────────────────────────────────────────
  mkdir -p "$(dirname "$BGS")"
  [ ! -e "$BGS" ] && touch "$BGS"
  [ ! -s "$BGS" ] && for f in $DIR/*; do echo "$f" >> "$BGS"; done
  BG=$(shuf -n 1 "$BGS")
# ──────────────────────────────────────────────────────────────────────────────────────────────
  grep -vF "$BG" "$BGS" > "${BGS}.tmp"
  mv "${BGS}.tmp" "$BGS"
# ──────────────────────────────────────────────────────────────────────────────────────────────
  ffmpeg -y -i "$BG" -vframes 1 -q:v 2 /tmp/matugen.jpg
  matugen image /tmp/matugen.jpg
# ──────────────────────────────────────────────────────────────────────────────────────────────
  pkill -x mpvpaper; pkill -x swaybg
  case "${BG,,}" in *.mp4 ) mpvpaper -p -o "no-audio loop" ALL "$BG" ;; esac
  case "${BG,,}" in *.jpg | *.jpeg | *.png ) swaybg -i "$BG" ;; esac
# ──────────────────────────────────────────────────────────────────────────────────────────────
