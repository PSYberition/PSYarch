#!/usr/bin/env bash
# ──────────────────────────────────────────────────────────────────────────────────────────────
  dir="$HOME/Pictures/Wallpapers"; bgs="$HOME/.local/state/bgs.txt"
# ──────────────────────────────────────────────────────────────────────────────────────────────
  if [[ "$1" != "run" ]]; then nohup "$0" run > /dev/null 2>&1 & disown; exit; fi
# ──────────────────────────────────────────────────────────────────────────────────────────────
  mkdir -p "$(dirname "$bgs")"; if [ ! -e "$bgs" ]; then touch "$bgs"; fi
  if [ ! -s "$bgs" ]; then (ls -l "$dir" | awk '{print $9}') | awk 'NF' > "$bgs"; fi
# ──────────────────────────────────────────────────────────────────────────────────────────────
  bg=$(shuf -n 1 "$bgs"); grep -vF "$bg" "$bgs" > "${bgs}.tmp"; mv "${bgs}.tmp" "$bgs"
# ──────────────────────────────────────────────────────────────────────────────────────────────
  ffmpeg -y -i "$dir/$bg" -vframes 1 -q:v 2 /tmp/matugen.jpg; matugen image /tmp/matugen.jpg
# ──────────────────────────────────────────────────────────────────────────────────────────────
  pkill mpvpaper; pkill swaybg
  case "${bg,,}" in *.mp4) mpvpaper -po "no-audio loop" ALL "$dir/$bg";;esac
  case "${bg,,}" in *.jpg|*.jpeg|*.png) swaybg -i "$dir/$bg";;esac
# ──────────────────────────────────────────────────────────────────────────────────────────────
